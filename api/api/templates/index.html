<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>NBA Shots</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.6.1/d3.min.js" integrity="sha512-MefNfAGJ/pEy89xLOFs3V6pYPs6AmUhXJrRlydI/9wZuGrqxmrdQ80zKHUcyadAcpH67teDZcBeS6oMJLPtTqw==" crossorigin="anonymous" referrerpolicy="no-referrer">
	</script>
    {% load static %}
</head>

<body>
	<main>
		<div class="container text-center">
            <h1>NBA Shot Data Visualization</h1>
            <div class="row">
                <div class="col-4 border">
                    <h2>League Comparison</h2>
                    <div id="shot-chart">
                        <img src="{% static 'leagueComparison.png' %}" alt="League Comparison" style="width: 100%">
                    </div>
                </div>
                <div class="col-4 border">
                    <div id="shot-chart2">
                        <label for="start">Start Date:</label>
                        <input class="form-control form-control-sm" type="date" placeholder="Start Date" id="start_date" name="start_date" value="2019-01-01">
                        <label for="end">End Date:</label>
                        <input class="form-control form-control-sm" type="date" placeholder="End Date" id="end_date" name="end_date" value="2019-01-01">
                        <label for="player">Player:</label>
                        <input class="form-control" id="player" type="text" placeholder="Search for a player..." list="players" style="position: relative; margin: 0 auto; display: block">
                        <datalist id="players"></datalist>
                        <label>Minimum</label>
                        <div class="input-group mb-3">
                            <input type="number" class="form-control form-control-sm" placeholder="PPG" aria-label="Points-Per-Game">
                            <input type="number" list="age" class="form-control form-control-sm" placeholder="Age" aria-label="Age">
                            <input type="number" class="form-control fomrm-control-sm" placeholder="Salary" aria-label="Salary">
                        </div>
                        <label>Maximum</label>
                        <div class="input-group mb-3">
                            <input type="number" class="form-control form-control-sm" placeholder="PPG" aria-label="Points-Per-Game">
                            <input type="number" class="form-control form-control-sm" placeholder="Age" aria-label="Age">
                            <input type="number" class="form-control fomrm-control-sm" placeholder="Salary" aria-label="Salary">
                        </div>
                    </div>
                </div>
                <div class="col-4 border">
                    <h2>Shot Chart</h2>
                    <div id="shot-chart3">
                        <img src="{% static 'heatmap.png' %}" alt="Heatmap" style="width: 100%">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-6 border">
                    <h2>Shot Type</h2>
                    <div id="shot-chart4">
                        <img src="{% static 'shotType.png' %}" alt="Shot Type" style="width: 100%">
                    </div>
                </div>
                <div class="col-6 border">
                    <h2>Shot Frequency</h2>
                    <div id="shot-chart5">
                        <img src="{% static 'shotFrequency.png' %}" alt="Shot Frequency" style="width: 100%">
                    </div>
                </div>
            </div>
		</div>
	</main>

</body>
<script>
    let players = fetch('http://' + window.location.host + '/players/get')
        .then(response => response.json())
        .then(data => {
            console.log("Data received: ", data);
            let players = data.players;
            console.log(players)
            let playerList = document.getElementById('players')
            players.forEach(player => {
                let option = document.createElement('option')
                option.value = player
                playerList.appendChild(option)
            })
        })
</script>
<script>
    class D3Chart{
    // Takes the selector that we want to build out chart on, as well as a path to read the data
    // sets up additional objects to hold axis, size, and margin information so it ban be accessed anywhere in the object
    constructor(selector, dataPath) {
        this.selector = selector
        this.dataPath = dataPath
        this.data = []
        this.size = {}
        this.margin = {}
        this.axis = {}
        this.svg = null
    }
    // resizes the object
    reSize(width, height){
        this.size.width = width
        this.size.height = height
    }
    // resets the margin object
    reMargin(top, right, bottom, left){
        this.margin.top = top
        this.margin.right = right
        this.margin.bottom = bottom
        this.margin.left = left
    }
    //TODO: integrate Axis building and scaling better into the object
    // builds and sets base SVG. It appends it to the selector for the object, and sets the margin correctly
    // Honeslty, this was the main reason I made the object. I didn't want to copy and paste it everywhere
    buildSVG() {
        let svg = d3.select(this.selector).append("svg")
            .attr("width", this.size.width + this.margin.left + this.margin.right)
            .attr("height", this.size.height + this.margin.top + this.margin.bottom)
            .append("g")
            .attr("transform", `translate(${this.margin.left},${this.margin.top})`)
        this.svg = svg
    }
    // Should be overwritten by instances. All axis building and setting should happen within this
    buildAxis() {
        console.log('Impliment Build Axis')
    }
    // Should be overwritten by instances. All updating information and axis should happen within this
    updateChart() {
        console.log('Impliment Update Data')
    }
	preBuild(){
		return
	}
	filterData(){
		return
	}
    // async method to get data
    async fetchData() {
        this.data = await d3.json(this.dataPath, function(data){
            return data
        })
    }

    // Call this to build chart
    async build() {
        this.buildSVG()

		this.preBuild()
        await this.fetchData()
		this.filterData()

        this.buildAxis()
        this.updateChart()
    }
    // Should be called everytime you want to fetch and update data
    async update() {
        await this.fetchData()
        this.updateChart()
    }
}
	
	let barChart = new D3Chart("#barChart","/shots/get/?player=Eddie%20Robinson&start_date=1999-01-01&end_date=2002-01-01")
	
	barChart.updateChart = function() {
		console.log(this.data)
	}
	barChart.build()
</script>
</html>